Oracle ADW와 OpenAI를 활용한 RAG 기반 감염병 모니터링 챗봇 구축 보고서
프로젝트 개요

본 프로젝트는 Oracle 23ai Autonomous Data Warehouse(ADW)에 저장된 대규모 감염병 데이터를 사용자가 자연어 질문을 통해 실시간으로 조회하고 분석할 수 있는 지능형 챗봇 시스템을 구축하는 것을 목표로 한다.
Retrieval-Augmented Generation (RAG) 아키텍처를 기반으로, 사용자의 질문 의도를 파악하여 동적으로 SQL 쿼리를 생성하고, 데이터베이스 조회 결과를 바탕으로 신뢰성 있는 답변을 제공하는 시스템을 구현하였다.
이 과정에서 발생한 다양한 기술적 문제들과 해결 과정을 상세히 기술하여 안정적인 AI 서비스 구축의 전 과정을 기록한다.

1. 시스템 아키텍처

본 챗봇 시스템은 사용자의 요청을 안전하고 효율적으로 처리하기 위해 여러 계층으로 구성된 표준 웹 서비스 아키텍처를 채택하였다.

사용자 (User): 웹 브라우저를 통해 시스템의 프론트엔드에 접속하여 자연어로 질문을 입력한다.

Nginx (Reverse Proxy): 시스템의 최전방에 위치한 관문(Gateway) 역할을 수행한다. 외부의 모든 웹 요청(80/443 포트)을 수신하여, 요청 경로(URL Path)에 따라 내부의 적절한 백엔드 서비스로 안전하게 전달(Proxying)한다.
이를 통해 로드 밸런싱, SSL 암호화 처리, 보안 강화 등의 이점을 얻는다. (구현 예정)

백엔드 서버 (OCI Compute VM): Oracle Cloud Infrastructure(OCI)의 가상 머신에 구축된 핵심 로직 수행부이다. 두 개의 독립적인 서비스로 구성된다.

NER 서비스 (포트 8000): 사용자의 질문에서 주요 단어(개체명)를 추출하는 전처리 역할을 한다 (현재는 구현 후 확장 가능).

챗봇 RAG 서비스 (포트 8001): main.py로 구현된 프로젝트의 핵심으로, NER을 거친 질문을 받아 RAG 파이프라인을 실행한다. OpenAI API를 호출하여 SQL을 생성하고, ADW에 쿼리를 실행하여 최종 결과를 반환한다.

OpenAI API: 외부 대규모 언어 모델(LLM)인 GPT-4o를 활용한다. 데이터베이스 스키마 정보와 사용자 질문을 바탕으로 Oracle SQL 쿼리를 생성하는 두뇌 역할을 수행한다.

Oracle 23ai ADW: 모든 감염병 통계 원본 데이터가 저장된 클라우드 데이터 웨어하우스이다. 챗봇이 생성한 SQL 쿼리를 받아 실행하고, 그 결과를 백엔드 서비스로 반환한다.

2. 핵심 기술 스택

인프라: Oracle Cloud Infrastructure (OCI) Compute VM

리버스 프록시: Nginx

백엔드 프레임워크: FastAPI (Python)

프론트엔드 프레임워크: React.js

서비스 관리: systemd (Linux)

데이터베이스: Oracle 23ai Autonomous Data Warehouse (ADW)

AI/LLM: OpenAI GPT-4o

라이브러리: Uvicorn, LangChain/LlamaIndex, SQLAlchemy, Transformers, Axios

3. RAG 챗봇 핵심 구현 내용 및 문제 해결 과정

본 챗봇은 단순히 라이브러리 기능에 의존하는 것을 넘어, 실제 운영 환경에서 발생하는 다양한 호환성 및 설정 문제를 해결하는 과정에서 고도화되었다. 초기 접근 방식의 한계를 극복하고 안정적인 수동 Text-to-SQL 파이프라인을 구축한 전 과정을 상세히 기술한다.

가. Text-to-SQL 수동 구현
LlamaIndex의 자동화된 Text-to-SQL 엔진의 호환성 문제를 해결하기 위해, 모든 단계를 직접 제어하는 수동 파이프라인을 구축했다.

프롬프트 엔지니어링: DB 뷰(View)의 구조(스키마)와 SQL 생성 규칙을 상세하게 정의한 프롬프트를 동적으로 생성한다.

LLM 직접 호출: LlamaIndex LLM 객체를 통해 구성된 프롬프트를 OpenAI API로 직접 전달한다.

SQL 추출: AI가 생성한 답변(설명 + SQL)에서 정규표현식(RegEx)을 사용하여 SQL 쿼리 부분만 정확히 추출한다.

DB 직접 실행: 추출된 SQL을 SQLAlchemy 엔진을 통해 ADW에서 실행하여 결과를 가져온다.

나. 프롬프트 엔지니어링 전략
수동 파이프라인의 성공은 AI에게 얼마나 정확하고 상세한 지시를 내리는가에 달려있다. 본 프로젝트에서는 AI의 SQL 생성 능력을 극대화하기 위해 다음과 같은 프롬프트 엔지니어링 기법을 적용했다.

행동 규칙 (Behavioral Rules): AI가 쿼리를 생성할 때 반드시 지켜야 할 행동 지침을 명시적으로 지시했다.

출력 형식 제어: 하나의 SQL 쿼리만 생성, 다른 설명이나 사과 제외, SELECT로 시작, 세미콜론 제외 등의 규칙을 통해 AI의 출력 형식을 표준화하여 SQL 추출 과정의 안정성을 높였다.

오류 방지 규칙: 컬럼 별칭(Alias)은 영어 사용, NULL 값 데이터 제외 등의 규칙을 추가하여, 특정 DB 환경에서 발생할 수 있는 오류를 AI가 스스로 피해가도록 유도했다.

스키마 정보 강화 (Schema Enrichment): DB 뷰(View)의 구조를 CREATE TABLE 형식으로 제공할 때, AI의 이해를 돕는 추가 정보를 주석(Comment)으로 삽입했다.

유사어/동의어 명시: 동정균주명 컬럼 설명에 Also called ''균'', ''병원균'' 과 같은 주석을 추가하여, 사용자가 사용하는 다양한 용어를 AI가 DB 컬럼과 매핑할 수 있도록 했다.

SQL 문법 유도: FETCH 문법이 일으키는 미묘한 오류를 피하기 위해, To get the top N results, please use a subquery with ROWNUM 이라는 주석을 추가하여 AI가 더 안정적인 ROWNUM 서브쿼리를 사용하도록 직접 안내했다.

다. 안정적인 서비스 운영
개발된 챗봇 애플리케이션이 24시간 안정적으로 운영될 수 있도록 인프라 환경을 구축했다.

nohup으로 실행 : chatbot과 ner 서비스를 nohup으로 실행했다. 이를 통해 PuTTY 접속이 끊겨도 서버가 계속 실행되어 서비스의 가용성을 극대화했다.

Nginx 리버스 프록시: 외부에는 표준 웹 포트(80)만 노출하고, 내부적으로는 Nginx가 각 서비스의 포트(8000, 8001)로 요청을 분배하는 리버스 프록시 구조를 완성했다. 이를 통해 보안을 강화하고, 향후 SSL 인증서 적용 및 로드 밸런싱 확장을 위한 기반을 마련했다.

4. 사용자 인터페이스(UI) 구현

사용자 경험을 극대화하기 위해 React.js를 사용하여 동적이고 직관적인 프론트엔드 인터페이스를 구현하였다.

가. 비동기 처리 시각화 및 사용자 피드백
챗봇이 질문을 처리하는 동안 사용자가 시스템의 상태를 명확히 인지할 수 있도록 비동기 로직을 시각적으로 표현하였다.

'진행중...' 상태 표시: 사용자가 질문을 전송하면 isLoading 상태를 true로 변경하고, "진행중..." 메시지를 화면에 표시한다. 이 동안에는 추가적인 질문 입력과 전송 버튼이 비활성화되어 중복 요청을 방지한다.

비동기 통신: axios 라이브러리를 사용하여 백엔드 API 서버와 비동기 HTTP POST 통신을 수행한다. 서버로부터 응답을 받거나 오류가 발생하면 isLoading 상태를 false로 되돌리고 로딩 표시를 제거하여 사용자가 즉시 다음 행동을 취할 수 있도록 한다.

나. 데이터 후처리 및 파일 저장 기능
챗봇이 반환한 데이터의 활용성을 높이기 위해, 조회된 DB 결과를 사용자가 직접 파일로 저장할 수 있는 기능을 구현하였다.

JSON to CSV 변환: 백엔드로부터 받은 db_result (JSON 배열) 데이터를 클라이언트(브라우저)에서 CSV(Comma-Separated Values) 형식의 문자열로 변환한다. 이 과정에서 데이터의 헤더를 자동으로 추출하고, 각 데이터 행을 CSV 규칙에 맞게 포맷팅한다.

파일 다운로드: 변환된 CSV 문자열을 Blob 객체로 생성하고, <a> 태그의 download 속성을 이용하여 사용자에게 파일 다운로드 기능을 제공한다. 한글 데이터가 깨지지 않도록 UTF-8 BOM을 포함하여 인코딩 문제를 해결하였다.

다. 동적이고 직관적인 UI/UX
사용자의 편의성을 고려하여 채팅창의 크기를 조절할 수 있는 등 동적인 UI 요소를 추가하였다.

크기 조절 채팅창: 사용자가 채팅창의 경계선을 마우스로 드래그하여 너비와 높이를 자유롭게 조절할 수 있는 기능을 구현하였다. 이를 통해 대시보드의 다른 정보와 함께 볼 때 화면 공간을 효율적으로 사용할 수 있도록 하였다.

자동 스크롤: 새로운 메시지가 추가될 때마다 채팅창의 스크롤을 자동으로 맨 아래로 이동시켜, 사용자가 항상 최신 대화 내용을 놓치지 않도록 하였다.

5. 결론

본 프로젝트는 Oracle ADW의 정형 데이터를 자연어로 탐색하는 RAG 기반 챗봇을 성공적으로 구축하였다. 이 과정에서 DB 연결, 라이브러리 호환성, 서버 배포, 네트워크 설정 등 실제 AI 서비스를 개발하며 마주할 수 있는 복합적인 문제들을 체계적으로 해결하였다.

특히, 자동화된 도구의 한계를 인지하고 수동으로 Text-to-SQL 파이프라인을 제어하는 방식으로 전환한 것과, AI의 성능을 극대화하기 위해 상세한 프롬프트 엔지니어링 기법을 적용한 것이 백엔드 성공의 핵심 요인이었다.
또한, React 기반의 프론트엔드를 통해 비동기 처리 상태를 명확히 보여주고 조회 결과를 파일로 저장하는 기능을 제공함으로써, 단순한 질의응답 시스템을 넘어 실용적인 데이터 분석 도구로서의 가능성을 제시하였다.
최종적으로 nohup와 Nginx를 통해 구축된 안정적인 서비스 환경은, 본 챗봇이 향후 실제 감염병 모니터링 시스템의 일부로 확장될 수 있는 견고한 기반이 될 것이다.
